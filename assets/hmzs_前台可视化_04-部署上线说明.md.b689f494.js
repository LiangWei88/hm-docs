import{_ as s,o as a,c as n,V as l}from"./chunks/framework.956eca13.js";const e="/hm-docs/assets/26.7a646be2.png",p="/hm-docs/assets/27.931b2356.png",o="/hm-docs/assets/28.c862c53e.png",t="/hm-docs/assets/29.c6b92f45.png",r="/hm-docs/assets/30.4558e355.png",c="/hm-docs/assets/31.7caa412c.png",i="/hm-docs/assets/32.dae8d00f.png",v=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"hmzs/前台可视化/04-部署上线说明.md","filePath":"hmzs/前台可视化/04-部署上线说明.md","lastUpdated":1694789836000}'),D={name:"hmzs/前台可视化/04-部署上线说明.md"},y=l('<h2 id="大厂-实际上线的流程说明" tabindex="-1">（大厂）实际上线的流程说明 <a class="header-anchor" href="#大厂-实际上线的流程说明" aria-label="Permalink to &quot;（大厂）实际上线的流程说明&quot;">​</a></h2><p><img src="'+e+'" alt="image.png" data-fancybox="gallery"></p><p>说明：前端需要做的事情就是配合发布</p><ol><li>确保提交的分支正确，分支代码里没有非常明显的错误，如代码冲突</li><li>因为部署平台要执行打包命令，这个打包命令是前端提供的，这里要对接好，并且打包时的优化要前端自己做</li></ol><h2 id="环境变量" tabindex="-1">环境变量 <a class="header-anchor" href="#环境变量" aria-label="Permalink to &quot;环境变量&quot;">​</a></h2><h3 id="认识环境变量" tabindex="-1">认识环境变量 <a class="header-anchor" href="#认识环境变量" aria-label="Permalink to &quot;认识环境变量&quot;">​</a></h3><p><strong>概念：同一个</strong><code>**&#39;变量&#39;**</code><strong>的值可以根据不同的环境自动切换与环境相对应的值，这样的变量就称之为环境变量</strong><img src="'+p+`" alt="image.png" data-fancybox="gallery"></p><blockquote><p>场景：项目上线时，我们的接口基地址发生了变化 由 &#39;<a href="https://api-hmzs.itheima.net/v1" target="_blank" rel="noreferrer">https://api-hmzs.itheima.net/v1</a>&#39; 变成了 <code>[https://api-hmzs.itheima.net/api](https://api-hmzs.itheima.net/api)</code><br> 如果适配开发阶段和上线之后的不同的接口基地址呢？答案就是使用环境变量，它可以做到在开发环境时接口走接口A，在上线之后走接口B</p></blockquote><h3 id="环境变量的定义和使用" tabindex="-1">环境变量的定义和使用 <a class="header-anchor" href="#环境变量的定义和使用" aria-label="Permalink to &quot;环境变量的定义和使用&quot;">​</a></h3><h3 id="定义位置和运行机制" tabindex="-1">定义位置和运行机制 <a class="header-anchor" href="#定义位置和运行机制" aria-label="Permalink to &quot;定义位置和运行机制&quot;">​</a></h3><table><thead><tr><th><strong>对应环境</strong></th><th><strong>文件</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td>开发环境</td><td>.env.development</td><td>当运行<code>vue-cli-service serve</code></td></tr><tr><td>的时候会以此文件为配置文件，这个文件中可以定义针对开发环境的环境变量</td><td></td><td></td></tr><tr><td>生产环境</td><td>.env.production</td><td>当运行<code>vue-cli-service build</code></td></tr><tr><td>的时候会以此文件为配置文件，这个文件中可以定义针对生产环境的环境变量</td><td></td><td></td></tr></tbody></table><h3 id="定义环境变量" tabindex="-1">定义环境变量 <a class="header-anchor" href="#定义环境变量" aria-label="Permalink to &quot;定义环境变量&quot;">​</a></h3><p>定义环境变量采用 <code>key = value</code>  的语法进行定义，其中key表示环境变量名称   value表示环境变量值</p><div class="language-json line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;"># just a flag</span></span>
<span class="line"><span style="color:#A6ACCD;">ENV = &#39;development&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;"># base api</span></span>
<span class="line"><span style="color:#A6ACCD;">VUE_APP_BASE_API = &#39;https:</span><span style="color:#676E95;font-style:italic;">//api-hmzs.itheima.net/v1&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="使用环境变量" tabindex="-1">使用环境变量 <a class="header-anchor" href="#使用环境变量" aria-label="Permalink to &quot;使用环境变量&quot;">​</a></h3><p>使用环境变量采用固定的前缀 <code>p<wbr>rocess.env.环境变量名</code>，环境变量名要与定义时的保持一致</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">process</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">env</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">VUE_APP_BASE_API</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="配置开发和生产环境下的baseurl" tabindex="-1">配置开发和生产环境下的baseURL <a class="header-anchor" href="#配置开发和生产环境下的baseurl" aria-label="Permalink to &quot;配置开发和生产环境下的baseURL&quot;">​</a></h3><div class="language-json line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;"># just a flag</span></span>
<span class="line"><span style="color:#A6ACCD;">ENV = &#39;development&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">VUE_APP_BASE_URL = &#39;https:</span><span style="color:#676E95;font-style:italic;">//api-hmzs.itheima.net/v1&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-json line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;"># just a flag</span></span>
<span class="line"><span style="color:#A6ACCD;">ENV = &#39;production&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;"># base api</span></span>
<span class="line"><span style="color:#A6ACCD;">VUE_APP_BASE_URL= &#39;https:</span><span style="color:#676E95;font-style:italic;">//api-hmzs.itheima.net/api&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="注意事项" tabindex="-1">注意事项 <a class="header-anchor" href="#注意事项" aria-label="Permalink to &quot;注意事项&quot;">​</a></h3><ol><li>客户端代码其实就是我们的<code>src目录</code>，如果在这个目录下使用环境变量，只能识别 <code>NODE_ENV</code>  <code>BASE_URL</code> 和以 <code>VUE_APP_</code>  打头的环境变量，其它变量不可识别，非客户端代码没有此要求。其中<code>NODE_ENV</code>  可以自定义覆盖， BASE_URL 覆盖不了</li><li>为避免记忆负担，在业务中自定义环境变量的时候，推荐采用严格的 <code>VUE_APP</code>变量前缀打头</li></ol><p><img src="`+o+'" alt="image.png" data-fancybox="gallery"></p><h2 id="微前端项目部署-了解-观看视频" tabindex="-1">微前端项目部署（了解-观看视频） <a class="header-anchor" href="#微前端项目部署-了解-观看视频" aria-label="Permalink to &quot;微前端项目部署（了解-观看视频）&quot;">​</a></h2><h3 id="服务器环境准备" tabindex="-1">服务器环境准备 <a class="header-anchor" href="#服务器环境准备" aria-label="Permalink to &quot;服务器环境准备&quot;">​</a></h3><p>我们在本地使用Node准备好了两台服务器，如下图所示： <img src="'+t+`" alt="image.png" data-fancybox="gallery"></p><ol><li>serverforadmin为服务器A，是后台管理项目部署的位置，服务地址为 <code>http://localhost:8086</code></li><li>serverforbigscreen为服务B，是前台可视化项目部署位置, 服务地址为<code>http://localhost:8089</code></li><li>每一个服务中都有一个<code>public文件夹</code>，它是静态服务文件夹，是放置我们打包之后的代码的</li><li>对俩个项目分别进行打包，然后把生成的dist目录下的文件放到对应的服务器的public文件夹中</li></ol><h3 id="根据环境切换加载子应用的地址" tabindex="-1">根据环境切换加载子应用的地址 <a class="header-anchor" href="#根据环境切换加载子应用的地址" aria-label="Permalink to &quot;根据环境切换加载子应用的地址&quot;">​</a></h3><blockquote><p>子应用大屏项目在开发时的服务地址为 <code>http://localhost:5173/big-screen</code>，在上线之后变成了<code>http://localhost:5173/big-screen</code>，为了适配上线之后的解析路径，我们根据当年所处的环境适配一下加载子应用的地址 p<wbr>rocess.env.NODE_ENV 可以拿到当前运行的环境，是生产还是开发 development为开发环境</p></blockquote><div class="language-vue line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">import { registerMicroApps, start } from &#39;qiankun&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">const isDev = p<wbr>rocess.env.NODE_ENV === &#39;development&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">registerMicroApps([</span></span>
<span class="line"><span style="color:#A6ACCD;">  {</span></span>
<span class="line"><span style="color:#A6ACCD;">    name: &#39;hmzs-big-screen&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">    entry: \`\${isDev ? &#39;//localhost:5173&#39; : &#39;//localhost:8089&#39;}\`,</span></span>
<span class="line"><span style="color:#A6ACCD;">    container: &#39;#container&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">    activeRule: &#39;/big-screen&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">start()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="更改子应用的base配置" tabindex="-1">更改子应用的base配置 <a class="header-anchor" href="#更改子应用的base配置" aria-label="Permalink to &quot;更改子应用的base配置&quot;">​</a></h3><blockquote><p>vite.config.js中的配置项里有一个base配置，它决定了项目启动时的静态资源，比如js，css从哪个服务器下去获取，因为上线之后，子应用大屏项目的服务器地址变成了 <code>http://localhost:8089</code> ，所以把base配置为 <code>http://localhost:8089</code></p></blockquote><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fileURLToPath</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">URL</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">node:url</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">defineConfig</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> vue </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@vitejs/plugin-vue</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> qiankun </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite-plugin-qiankun</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">defineConfig</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">base</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">http://localhost:8089/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#82AAFF;">vue</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">qiankun</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hmzs-big-screen</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">useDevMode</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">server</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 解决开发环境下的静态资源访问问题</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">origin</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">//127.0.0.1:5173</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">resolve</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">alias</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">@</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">fileURLToPath</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">URL</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./src</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">url))</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="更改子应用的路由" tabindex="-1">更改子应用的路由 <a class="header-anchor" href="#更改子应用的路由" aria-label="Permalink to &quot;更改子应用的路由&quot;">​</a></h3><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">createRouter</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">createWebHistory</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue-router</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> HomeView </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">../views/HomeView.vue</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> router </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createRouter</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">history</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createWebHistory</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> router</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="打包独立部署到服务器" tabindex="-1">打包独立部署到服务器 <a class="header-anchor" href="#打包独立部署到服务器" aria-label="Permalink to &quot;打包独立部署到服务器&quot;">​</a></h3><blockquote><p>在俩个项目中分别执行打包命令，生成打包文件之后，把打包文件手动拷贝到对应的服务器的public文件夹里 执行 <code>node app.js</code> 启动对应的服务器</p></blockquote><p><img src="`+r+'" alt="image.png" data-fancybox="gallery"></p><h3 id="ngnix配置" tabindex="-1">Ngnix配置 <a class="header-anchor" href="#ngnix配置" aria-label="Permalink to &quot;Ngnix配置&quot;">​</a></h3><p><img src="'+c+'" alt="image.png" data-fancybox="gallery"><img src="'+i+'" alt="image.png" data-fancybox="gallery"></p>',40),d=[y];function b(A,C,F,m,u,h){return a(),n("div",null,d)}const f=s(D,[["render",b]]);export{v as __pageData,f as default};
